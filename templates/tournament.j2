<!DOCTYPE html>
<html>

<head>
    <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        body {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: #E9C46A;
            padding: 1.25em;
        }

        .editable {
            border-collapse: collapse;
        }

        .editable th,
        .editable td {
            text-align: left;
            padding: .938rem;
        }

        .editable th.edit {
            background: #f8ff88;
        }

        .header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 1.25em;
            /* Add margin to separate the header from the table */
        }

        h1 {
            font-weight: bold;
            font-size: 2em;
            color: #264653;
            margin-right: auto;
            /* Push the table to the right */
        }

        .table_results {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        table {
            font-weight: bold;
            color: #264653;
            border: 1px solid black;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 0.63em;
            /* Add padding to the table cells */
        }

        tr:hover {
            background: #EDD69C;
        }
    </style>

    <title>{{ tournament }}</title>
</head>

<body>
    <div class="header">
        <h1>{{ tournament }} Results</h1>
    </div>

    <div class="results">
        <table class="editable">
            {% for row in data %}
            <tr class="row">
                {% for cell in row %}
                <th> {{cell}} </th>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>
    </div>
</body>

</html>


<script>
    // (A) INITIALIZE - DOUBLE CLICK TO EDIT CELL
    window.addEventListener("DOMContentLoaded", () => {
        for (let cell of document.querySelectorAll(".editable th")) {
            cell.ondblclick = () => editable.edit(cell);
        }
    });

    var editable = {
        // (B) PROPERTIES
        selected: null,  // current selected cell
        value: "", // current selected cell value

        // (C) "CONVERT" TO EDITABLE CELL
        edit: cell => {
            // (C1) REMOVE "DOUBLE CLICK TO EDIT"
            cell.ondblclick = "";

            // (C2) EDITABLE CONTENT
            cell.contentEditable = true;
            cell.focus();

            // (C3) "MARK" CURRENT SELECTED CELL
            cell.classList.add("edit");
            editable.selected = cell;
            editable.value = cell.innerHTML;

            // (C4) PRESS ENTER/ESC OR CLICK OUTSIDE TO END EDIT
            window.addEventListener("click", editable.close);
            cell.onkeydown = evt => {
                if (evt.key == "Enter" || evt.key == "Escape") {
                    editable.close(evt.key == "Enter" ? true : false);
                    return false;
                }
            };
        },

        // (D) END "EDIT MODE"
        close: evt => {
            if (evt.target != editable.selected) {
                // (D1) CANCEL - RESTORE PREVIOUS VALUE
                if (evt === false) {
                    editable.selected.innerHTML = editable.value;
                }

                // (D2) REMOVE "EDITABLE"
                window.getSelection().removeAllRanges();
                editable.selected.contentEditable = false;

                // (D3) RESTORE CLICK LISTENERS
                window.removeEventListener("click", editable.close);
                let cell = editable.selected;
                cell.onkeydown = "";
                cell.ondblclick = () => editable.edit(cell);

                // (D4) "UNMARK" CURRENT SELECTED CELL
                editable.selected.classList.remove("edit");
                editable.selected = null;
                editable.value = "";

                // (D5) DO WHATEVER YOU NEED
                if (evt !== false) {
                    console.log(cell.innerHTML);
                    // FIX THIS VERIFY THAT ONLY TO'S ARE EDITING
                    // FIX THIS MAKE IT SEND TO SERVER
                }
            }
        }
    };

</script>